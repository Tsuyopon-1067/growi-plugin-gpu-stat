var X={exports:{}},B={},Z={exports:{}},i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te;function ce(){if(te)return i;te=1;var n=Symbol.for("react.element"),s=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),y=Symbol.for("react.context"),$=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),E=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),u=Symbol.iterator;function h(e){return e===null||typeof e!="object"?null:(e=u&&e[u]||e["@@iterator"],typeof e=="function"?e:null)}var N={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,c={};function R(e,r,l){this.props=e,this.context=r,this.refs=c,this.updater=l||N}R.prototype.isReactComponent={},R.prototype.setState=function(e,r){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,r,"setState")},R.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function D(){}D.prototype=R.prototype;function U(e,r,l){this.props=e,this.context=r,this.refs=c,this.updater=l||N}var T=U.prototype=new D;T.constructor=U,b(T,R.prototype),T.isPureReactComponent=!0;var L=Array.isArray,P=Object.prototype.hasOwnProperty,I={current:null},q={key:!0,ref:!0,__self:!0,__source:!0};function H(e,r,l){var x,f={},_=null,S=null;if(r!=null)for(x in r.ref!==void 0&&(S=r.ref),r.key!==void 0&&(_=""+r.key),r)P.call(r,x)&&!q.hasOwnProperty(x)&&(f[x]=r[x]);var w=arguments.length-2;if(w===1)f.children=l;else if(1<w){for(var g=Array(w),O=0;O<w;O++)g[O]=arguments[O+2];f.children=g}if(e&&e.defaultProps)for(x in w=e.defaultProps,w)f[x]===void 0&&(f[x]=w[x]);return{$$typeof:n,type:e,key:_,ref:S,props:f,_owner:I.current}}function F(e,r){return{$$typeof:n,type:e.type,key:r,ref:e.ref,props:e.props,_owner:e._owner}}function V(e){return typeof e=="object"&&e!==null&&e.$$typeof===n}function K(e){var r={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(l){return r[l]})}var z=/\/+/g;function G(e,r){return typeof e=="object"&&e!==null&&e.key!=null?K(""+e.key):r.toString(36)}function k(e,r,l,x,f){var _=typeof e;(_==="undefined"||_==="boolean")&&(e=null);var S=!1;if(e===null)S=!0;else switch(_){case"string":case"number":S=!0;break;case"object":switch(e.$$typeof){case n:case s:S=!0}}if(S)return S=e,f=f(S),e=x===""?"."+G(S,0):x,L(f)?(l="",e!=null&&(l=e.replace(z,"$&/")+"/"),k(f,r,l,"",function(O){return O})):f!=null&&(V(f)&&(f=F(f,l+(!f.key||S&&S.key===f.key?"":(""+f.key).replace(z,"$&/")+"/")+e)),r.push(f)),1;if(S=0,x=x===""?".":x+":",L(e))for(var w=0;w<e.length;w++){_=e[w];var g=x+G(_,w);S+=k(_,r,l,g,f)}else if(g=h(e),typeof g=="function")for(e=g.call(e),w=0;!(_=e.next()).done;)_=_.value,g=x+G(_,w++),S+=k(_,r,l,g,f);else if(_==="object")throw r=String(e),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return S}function C(e,r,l){if(e==null)return e;var x=[],f=0;return k(e,x,"","",function(_){return r.call(l,_,f++)}),x}function M(e){if(e._status===-1){var r=e._result;r=r(),r.then(function(l){(e._status===0||e._status===-1)&&(e._status=1,e._result=l)},function(l){(e._status===0||e._status===-1)&&(e._status=2,e._result=l)}),e._status===-1&&(e._status=0,e._result=r)}if(e._status===1)return e._result.default;throw e._result}var j={current:null},A={transition:null},Q={ReactCurrentDispatcher:j,ReactCurrentBatchConfig:A,ReactCurrentOwner:I};return i.Children={map:C,forEach:function(e,r,l){C(e,function(){r.apply(this,arguments)},l)},count:function(e){var r=0;return C(e,function(){r++}),r},toArray:function(e){return C(e,function(r){return r})||[]},only:function(e){if(!V(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},i.Component=R,i.Fragment=o,i.Profiler=d,i.PureComponent=U,i.StrictMode=a,i.Suspense=m,i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,i.cloneElement=function(e,r,l){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var x=b({},e.props),f=e.key,_=e.ref,S=e._owner;if(r!=null){if(r.ref!==void 0&&(_=r.ref,S=I.current),r.key!==void 0&&(f=""+r.key),e.type&&e.type.defaultProps)var w=e.type.defaultProps;for(g in r)P.call(r,g)&&!q.hasOwnProperty(g)&&(x[g]=r[g]===void 0&&w!==void 0?w[g]:r[g])}var g=arguments.length-2;if(g===1)x.children=l;else if(1<g){w=Array(g);for(var O=0;O<g;O++)w[O]=arguments[O+2];x.children=w}return{$$typeof:n,type:e.type,key:f,ref:_,props:x,_owner:S}},i.createContext=function(e){return e={$$typeof:y,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:p,_context:e},e.Consumer=e},i.createElement=H,i.createFactory=function(e){var r=H.bind(null,e);return r.type=e,r},i.createRef=function(){return{current:null}},i.forwardRef=function(e){return{$$typeof:$,render:e}},i.isValidElement=V,i.lazy=function(e){return{$$typeof:v,_payload:{_status:-1,_result:e},_init:M}},i.memo=function(e,r){return{$$typeof:E,type:e,compare:r===void 0?null:r}},i.startTransition=function(e){var r=A.transition;A.transition={};try{e()}finally{A.transition=r}},i.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},i.useCallback=function(e,r){return j.current.useCallback(e,r)},i.useContext=function(e){return j.current.useContext(e)},i.useDebugValue=function(){},i.useDeferredValue=function(e){return j.current.useDeferredValue(e)},i.useEffect=function(e,r){return j.current.useEffect(e,r)},i.useId=function(){return j.current.useId()},i.useImperativeHandle=function(e,r,l){return j.current.useImperativeHandle(e,r,l)},i.useInsertionEffect=function(e,r){return j.current.useInsertionEffect(e,r)},i.useLayoutEffect=function(e,r){return j.current.useLayoutEffect(e,r)},i.useMemo=function(e,r){return j.current.useMemo(e,r)},i.useReducer=function(e,r,l){return j.current.useReducer(e,r,l)},i.useRef=function(e){return j.current.useRef(e)},i.useState=function(e){return j.current.useState(e)},i.useSyncExternalStore=function(e,r,l){return j.current.useSyncExternalStore(e,r,l)},i.useTransition=function(){return j.current.useTransition()},i.version="18.2.0",i}var re;function ae(){return re||(re=1,Z.exports=ce()),Z.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ne;function le(){if(ne)return B;ne=1;var n=ae(),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,d=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function y($,m,E){var v,u={},h=null,N=null;E!==void 0&&(h=""+E),m.key!==void 0&&(h=""+m.key),m.ref!==void 0&&(N=m.ref);for(v in m)a.call(m,v)&&!p.hasOwnProperty(v)&&(u[v]=m[v]);if($&&$.defaultProps)for(v in m=$.defaultProps,m)u[v]===void 0&&(u[v]=m[v]);return{$$typeof:s,type:$,key:h,ref:N,props:u,_owner:d.current}}return B.Fragment=o,B.jsx=y,B.jsxs=y,B}var se;function ue(){return se||(se=1,X.exports=le()),X.exports}var t=ue(),de=ae();const Y=n=>window.growiFacade.react;async function fe(n){let s="";try{const o=await fetch(n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=new Date().toISOString();return s=await o.text(),s=s.replace(/,{2,}/g,","),{stats:JSON.parse(s),lastModified:a}}catch(o){throw o instanceof SyntaxError?(console.error("Failed to parse JSON after comma fix:",o),console.error("Fixed response was:",s),new Error(`JSON parse error: ${o.message}`)):o}}const pe="/__gpustat__";function me(){const n=Y(),{useState:s,useCallback:o,useEffect:a}=n,[d,p]=s([]),[y,$]=s(null),[m,E]=s(null),[v,u]=s(null),h=o(async()=>{$(null);try{const{stats:N,lastModified:b}=await fe(pe);p(N),u(b),E(new Date)}catch(N){console.error(N),$("Failed to fetch GPU stats.")}},[]);return a(()=>{h();const N=setInterval(h,3e4);return()=>clearInterval(N)},[h]),{stats:d,error:y,lastClientUpdate:m,lastApiUpdate:v,refresh:h}}const ie=de.createContext(null);function xe({children:n}){const s=me();return t.jsx(ie.Provider,{value:s,children:n})}const J=n=>n!=null;function he({stats:n}){return t.jsx("div",{className:"overflow-x-auto w-full",children:t.jsxs("table",{className:"w-full bg-white text-xl",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-3 border-b-2 border-stone-200",children:"サーバ"}),t.jsx("th",{className:"py-2 px-3 border-b-2 border-stone-200",children:"GPU"}),t.jsx("th",{className:"py-2 px-3 border-b-2 border-stone-200",children:"温度"}),t.jsx("th",{className:"py-2 px-3 border-b-2 border-stone-200",children:"計算負荷"}),t.jsx("th",{className:"py-2 px-3 border-b-2 border-stone-200",children:"メモリ (GiB)"}),t.jsx("th",{className:"py-2 px-3 border-b-2 border-stone-200",children:"利用者"})]})}),t.jsx("tbody",{children:n.map(s=>s.gpus.map((o,a)=>{const p=`py-2 px-1 ${a===s.gpus.length-1?"border-b-2 border-stone-200":""}`,y=`${p} text-center`,$=o.name?.replace("Ada Generation","Ada"),m=o["utilization.gpu"]??0,v=Math.max(m-80,0)/20*16;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:p,children:a===0?s.hostname:""}),t.jsx("td",{className:p,children:$}),t.jsxs("td",{className:y,children:[o["temperature.gpu"]," °C"]}),t.jsxs("td",{className:y,children:[o["utilization.gpu"]," %",t.jsx("span",{className:"ml-1",style:{fontSize:v+"px"},children:"🔥"})]}),t.jsx("td",{className:y,children:(()=>{const u=o["memory.used"],h=o["memory.total"],N=J(u)?(u/1024).toFixed(1):"N/A",b=J(h)?(h/1024).toFixed(1):"N/A";let c="";if(J(u)&&J(h)){const R=u/h;R>=.9?c="😭":R>=.8?c="😢️":R>=.7&&(c="🥺️")}return`${N} / ${b} ${c}`})()}),t.jsx("td",{className:p,children:o.processes?.map(u=>{const h=u.gpu_memory_usage?(u.gpu_memory_usage/1024).toFixed(1):"N/A";return`${u.username} (${h}GiB)`}).join(", ")})]},`${s.hostname}-${o.uuid}`)}))})]})})}const ee=n=>{const s=(1-n/100)*160,[o,a,d]=ye(s,.85,.9);return`hsl(${o}, ${a}%, ${d}%)`},ye=(n,s,o)=>{const a=o*(2-s)/2,d=(o-a)/Math.min(a,1-a);return[n,d*100,a*100]},oe=({value:n=75,min:s=0,max:o=100,startAngle:a=-135,endAngle:d=135,size:p=140,strokeWidth:y=12,label:$="Performance",subLabel:m,unit:E="%",showTicks:v=!0,tickCount:u=10,colors:h=ee})=>{const N=Y(),{useId:b}=N,c=b(),R=`gaugeGradient-${c}`,D=`shadow-${c}`,U=Math.max(s,Math.min(o,n)),T=(U-s)/(o-s)*100,L=d-a,P=p/2,I=(p-y)/2,q=L/360*2*Math.PI*I,H=q*(1-T/100),F=(G,k=I)=>{const C=(G-90)*Math.PI/180;return{x:P+k*Math.cos(C),y:P+k*Math.sin(C)}},V=(G,k,C=I)=>{const M=F(G,C),j=F(k,C),A=k-G<=180?"0":"1";return`M ${M.x} ${M.y} A ${C} ${C} 0 ${A} 1 ${j.x} ${j.y}`},K=()=>{if(!v)return[];const G=[];for(let k=0;k<=u;k++){const C=a+L*k/u,M=F(C,I+5),j=F(C,I+12),A=F(C,I+20),Q=s+(o-s)*k/u;G.push(t.jsxs("g",{children:[t.jsx("line",{x1:M.x,y1:M.y,x2:j.x,y2:j.y,stroke:"#94a3b8",strokeWidth:"2"}),t.jsx("text",{x:A.x,y:A.y,textAnchor:"middle",dominantBaseline:"middle",className:"text-[10px] fill-slate-600",children:Math.round(Q)})]},`tick-${k}`))}return G},z=h(T);return t.jsx("div",{className:"flex flex-col items-center pt-6 pb-0 px-2",children:t.jsxs("svg",{width:p,height:p,className:"transform -rotate-0",style:{overflow:"visible"},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:R,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:z,stopOpacity:"0.8"}),t.jsx("stop",{offset:"100%",stopColor:z,stopOpacity:"1"})]}),t.jsx("filter",{id:D,children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodOpacity:"0.2"})})]}),K(),t.jsx("path",{d:V(a,d),fill:"none",stroke:"#e5e7eb",strokeWidth:y,strokeLinecap:"round"}),t.jsx("path",{d:V(a,d),fill:"none",stroke:`url(#${R})`,strokeWidth:y,strokeLinecap:"round",filter:`url(#${D})`,strokeDasharray:q,strokeDashoffset:H,style:{transition:"stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}}),t.jsxs("text",{x:P,y:P-(m?20:10),textAnchor:"middle",dominantBaseline:"middle",className:"text-2xl font-semibold fill-slate-800",children:[U.toFixed(1),t.jsx("tspan",{className:"text-base fill-slate-600",children:E})]}),m&&t.jsxs("text",{x:P,y:P+8,textAnchor:"middle",dominantBaseline:"middle",className:"text-xl font-semibold fill-slate-500",children:[m,t.jsx("tspan",{className:"text-xs fill-slate-500",children:"W"})]}),t.jsx("text",{x:P,y:P+(m?32:15),textAnchor:"middle",dominantBaseline:"middle",className:"text-sm fill-slate-500",children:$})]})})},ve=({processes:n})=>{const s=a=>a?(a/1024).toFixed(1):"N/A",o=n?.map(a=>`${a.username||"Unknown"} (${s(a.gpu_memory_usage)}GB)`).join(", ");return t.jsxs("div",{className:"flex flex-col min-w-[160px]",children:[t.jsx("div",{className:"px-4 py-1 mb-2 text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Processes"}),t.jsx("div",{className:"px-4 py-2 ml-2 mb-3 text-xs flex-1 border-l-2 border-gray-300 box-border",children:o})]})},je="_container_1ncyu_1",ge="_header_1ncyu_10",be="_gpuName_1ncyu_14",_e="_gauges_1ncyu_19",W={container:je,header:ge,gpuName:be,gauges:_e},we=({value:n=50,min:s=0,max:o=100,height:a=200,width:d=16,animated:p=!0})=>{const y=Y(),{useState:$,useEffect:m}=y,[E,v]=$(n),u=Math.max(0,Math.min(100,(E-s)/(o-s)*100)),h=b=>{const R=Math.min(100,b/85*100);return ee(R)},N=b=>b<=0?h(0):`linear-gradient(to top in oklch, ${Array.from({length:15},(D,U)=>{const T=U/14*b;return h(T)}).join(", ")})`;return m(()=>{v(n)},[n]),t.jsxs("div",{className:"flex flex-col items-center gap-1 pb-1 pt-2 px-0",children:[t.jsxs("div",{className:"relative flex items-start gap-4",style:{height:`${a}px`},children:[t.jsxs("div",{className:"relative",style:{width:`${d}px`,height:"100%"},children:[t.jsx("div",{className:"absolute inset-0 bg-gray-200"}),t.jsx("div",{className:`absolute bottom-0 left-0 right-0 ${p?"transition-all duration-500 ease-in-out":""}`,style:{height:`${u}%`,background:N(u)}})]}),t.jsx("div",{className:"relative h-full",children:[0,25,50,75,100].map(b=>t.jsxs("div",{className:"absolute flex items-center gap-1",style:{bottom:`${b}%`,transform:"translateY(50%)",left:"-16px"},children:[t.jsx("div",{className:"w-3 h-0.5 bg-gray-400"}),t.jsx("span",{className:"text-xs text-gray-600 font-[10px] w-[24px]",children:Math.round(s+(o-s)*b/100)})]},b))})]}),t.jsx("div",{className:"text-center",children:t.jsxs("div",{className:"text-xl font-semibold w-[80px]",style:{color:ee(u)},children:[E.toFixed(1),"°C"]})})]})};function Ne({gpu:n}){const s=n["utilization.gpu"]??0,o=n["memory.used"]??0,a=n["memory.total"]??0,d=n["temperature.gpu"]??0,p=n["power.draw"]??0,y=(a/1024).toFixed(1);return t.jsxs("div",{className:W.container,children:[t.jsx("div",{className:W.header,children:t.jsxs("h3",{className:W.gpuName,children:["GPU ",n.index,": ",n.name," | ",y," GiB"]})}),t.jsxs("div",{className:W.gauges,children:[t.jsx("div",{}),t.jsx(we,{value:d,max:100,height:130}),t.jsx("div",{}),t.jsx(oe,{value:s,subLabel:p.toString(),label:"Utilization",unit:"%"}),t.jsx("div",{}),t.jsx(oe,{value:o/1024,max:a/1024,label:"Memory",unit:"GiB"}),t.jsx("div",{}),t.jsx(ve,{processes:n.processes}),t.jsx("div",{})]})]})}function Se({stat:n}){return t.jsx("div",{children:n.gpus.map(s=>t.jsx(Ne,{gpu:s},s.index))})}const $e=n=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",enableBackground:"new 0 0 65 65",viewBox:"0 0 65 65",...n,children:t.jsx("g",{id:"Layer_3_copy_2",children:t.jsxs("g",{fill:"currentColor",children:[t.jsx("path",{d:"m32.5 4.999c-5.405 0-10.444 1.577-14.699 4.282l-5.75-5.75v16.11h16.11l-6.395-6.395c3.18-1.787 6.834-2.82 10.734-2.82 12.171 0 22.073 9.902 22.073 22.074 0 2.899-0.577 5.664-1.599 8.202l4.738 2.762c1.47-3.363 2.288-7.068 2.288-10.964 0-15.164-12.337-27.501-27.5-27.501z"}),t.jsx("path",{d:"m43.227 51.746c-3.179 1.786-6.826 2.827-10.726 2.827-12.171 0-22.073-9.902-22.073-22.073 0-2.739 0.524-5.35 1.439-7.771l-4.731-2.851c-1.375 3.271-2.136 6.858-2.136 10.622 0 15.164 12.336 27.5 27.5 27.5 5.406 0 10.434-1.584 14.691-4.289l5.758 5.759v-16.112h-16.111l6.389 6.388z"})]})})}),Re=()=>{const n=Y(),{useState:s,useContext:o}=n,a=o(ie),[d,p]=s("all");if(!a)throw new Error("GpuStatusDisplay must be used within a GpuStatsProvider");const{stats:y,error:$,lastApiUpdate:m,refresh:E}=a,v=["all",...new Set(y.map(c=>c.hostname).filter(c=>c))],u=c=>c?c.toLocaleString():"N/A",h=c=>c?u(new Date(c)):"N/A",N=c=>`px-4 py-2 text-lg font-semibold border-b-2${d===c?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,b=d==="all"?null:y.find(c=>c.hostname===d);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("button",{onClick:E,className:"w-8 h-8 p-2 rounded-full hover:bg-gray-200 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gray-400 flex items-center justify-center",style:{borderRadius:"50%"},children:t.jsx($e,{className:"w-6 h-6",color:"#2b7fff"})}),t.jsx("div",{className:"text-sm text-gray-600",children:t.jsxs("p",{className:"m-0",children:["Last Updated: ",h(m)]})})]}),$&&t.jsx("p",{className:"text-red-500",children:$}),t.jsx("div",{className:"border-b-2 border-stone-200",children:t.jsx("nav",{className:"-mb-px flex","aria-label":"Tabs",children:v.map(c=>t.jsx("button",{onClick:()=>p(c),className:N(c),children:c==="all"?"All":c},c))})}),t.jsx("div",{className:"mt-4",children:d==="all"?t.jsx(he,{stats:y}):b?t.jsx(Se,{stat:b}):t.jsx("p",{children:"Host not found."})})]})},ke=()=>t.jsx(xe,{children:t.jsx(Re,{})}),Ce=()=>{if(growiFacade==null||growiFacade.markdownRenderer==null)return;const{optionsGenerators:n}=growiFacade.markdownRenderer,s=n.customGenerateViewOptions;n.customGenerateViewOptions=(...o)=>{const a=s?s(...o):n.generateViewOptions(...o),d=a.components.table;return a.components.table=p=>p.className?.includes("gpu-stat")?t.jsx(ke,{...p}):t.jsx(d,{...p}),a}},Ee=()=>{};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators["growi-plugin-gpu-stat"]={activate:Ce,deactivate:Ee};
