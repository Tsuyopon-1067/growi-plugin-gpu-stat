var z={exports:{}},F={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z;function ce(){if(Z)return F;Z=1;var s=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function o(c,l,f){var y=null;if(f!==void 0&&(y=""+f),l.key!==void 0&&(y=""+l.key),"key"in l){f={};for(var j in l)j!=="key"&&(f[j]=l[j])}else f=l;return l=f.ref,{$$typeof:s,type:c,key:y,ref:l!==void 0?l:null,props:f}}return F.Fragment=n,F.jsx=o,F.jsxs=o,F}var K;function le(){return K||(K=1,z.exports=ce()),z.exports}var r=le(),J={exports:{}},a={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee;function fe(){if(ee)return a;ee=1;var s=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),f=Symbol.for("react.consumer"),y=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),E=Symbol.for("react.activity"),w=Symbol.iterator;function N(e){return e===null||typeof e!="object"?null:(e=w&&e[w]||e["@@iterator"],typeof e=="function"?e:null)}var _={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,k={};function P(e,t,u){this.props=e,this.context=t,this.refs=k,this.updater=u||_}P.prototype.isReactComponent={},P.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},P.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function I(){}I.prototype=P.prototype;function b(e,t,u){this.props=e,this.context=t,this.refs=k,this.updater=u||_}var G=b.prototype=new I;G.constructor=b,m(G,P.prototype),G.isPureReactComponent=!0;var L=Array.isArray;function D(){}var d={H:null,A:null,T:null,S:null},Y=Object.prototype.hasOwnProperty;function q(e,t,u){var i=u.ref;return{$$typeof:s,type:e,key:t,ref:i!==void 0?i:null,props:u}}function V(e,t){return q(e.type,t,e.props)}function S(e){return typeof e=="object"&&e!==null&&e.$$typeof===s}function C(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(u){return t[u]})}var R=/\/+/g;function O(e,t){return typeof e=="object"&&e!==null&&e.key!=null?C(""+e.key):t.toString(36)}function H(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(D,D):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function $(e,t,u,i,p){var x=typeof e;(x==="undefined"||x==="boolean")&&(e=null);var h=!1;if(e===null)h=!0;else switch(x){case"bigint":case"string":case"number":h=!0;break;case"object":switch(e.$$typeof){case s:case n:h=!0;break;case A:return h=e._init,$(h(e._payload),t,u,i,p)}}if(h)return p=p(e),h=i===""?"."+O(e,0):i,L(p)?(u="",h!=null&&(u=h.replace(R,"$&/")+"/"),$(p,t,u,"",function(ue){return ue})):p!=null&&(S(p)&&(p=V(p,u+(p.key==null||e&&e.key===p.key?"":(""+p.key).replace(R,"$&/")+"/")+h)),t.push(p)),1;h=0;var M=i===""?".":i+":";if(L(e))for(var T=0;T<e.length;T++)i=e[T],x=M+O(i,T),h+=$(i,t,u,x,p);else if(T=N(e),typeof T=="function")for(e=T.call(e),T=0;!(i=e.next()).done;)i=i.value,x=M+O(i,T++),h+=$(i,t,u,x,p);else if(x==="object"){if(typeof e.then=="function")return $(H(e),t,u,i,p);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return h}function U(e,t,u){if(e==null)return e;var i=[],p=0;return $(e,i,"","",function(x){return t.call(u,x,p++)}),i}function ae(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(u){(e._status===0||e._status===-1)&&(e._status=1,e._result=u)},function(u){(e._status===0||e._status===-1)&&(e._status=2,e._result=u)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var X=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},ie={map:U,forEach:function(e,t,u){U(e,function(){t.apply(this,arguments)},u)},count:function(e){var t=0;return U(e,function(){t++}),t},toArray:function(e){return U(e,function(t){return t})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return a.Activity=E,a.Children=ie,a.Component=P,a.Fragment=o,a.Profiler=l,a.PureComponent=b,a.StrictMode=c,a.Suspense=v,a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=d,a.__COMPILER_RUNTIME={__proto__:null,c:function(e){return d.H.useMemoCache(e)}},a.cache=function(e){return function(){return e.apply(null,arguments)}},a.cacheSignal=function(){return null},a.cloneElement=function(e,t,u){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var i=m({},e.props),p=e.key;if(t!=null)for(x in t.key!==void 0&&(p=""+t.key),t)!Y.call(t,x)||x==="key"||x==="__self"||x==="__source"||x==="ref"&&t.ref===void 0||(i[x]=t[x]);var x=arguments.length-2;if(x===1)i.children=u;else if(1<x){for(var h=Array(x),M=0;M<x;M++)h[M]=arguments[M+2];i.children=h}return q(e.type,p,i)},a.createContext=function(e){return e={$$typeof:y,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:f,_context:e},e},a.createElement=function(e,t,u){var i,p={},x=null;if(t!=null)for(i in t.key!==void 0&&(x=""+t.key),t)Y.call(t,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(p[i]=t[i]);var h=arguments.length-2;if(h===1)p.children=u;else if(1<h){for(var M=Array(h),T=0;T<h;T++)M[T]=arguments[T+2];p.children=M}if(e&&e.defaultProps)for(i in h=e.defaultProps,h)p[i]===void 0&&(p[i]=h[i]);return q(e,x,p)},a.createRef=function(){return{current:null}},a.forwardRef=function(e){return{$$typeof:j,render:e}},a.isValidElement=S,a.lazy=function(e){return{$$typeof:A,_payload:{_status:-1,_result:e},_init:ae}},a.memo=function(e,t){return{$$typeof:g,type:e,compare:t===void 0?null:t}},a.startTransition=function(e){var t=d.T,u={};d.T=u;try{var i=e(),p=d.S;p!==null&&p(u,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(D,X)}catch(x){X(x)}finally{t!==null&&u.types!==null&&(t.types=u.types),d.T=t}},a.unstable_useCacheRefresh=function(){return d.H.useCacheRefresh()},a.use=function(e){return d.H.use(e)},a.useActionState=function(e,t,u){return d.H.useActionState(e,t,u)},a.useCallback=function(e,t){return d.H.useCallback(e,t)},a.useContext=function(e){return d.H.useContext(e)},a.useDebugValue=function(){},a.useDeferredValue=function(e,t){return d.H.useDeferredValue(e,t)},a.useEffect=function(e,t){return d.H.useEffect(e,t)},a.useEffectEvent=function(e){return d.H.useEffectEvent(e)},a.useId=function(){return d.H.useId()},a.useImperativeHandle=function(e,t,u){return d.H.useImperativeHandle(e,t,u)},a.useInsertionEffect=function(e,t){return d.H.useInsertionEffect(e,t)},a.useLayoutEffect=function(e,t){return d.H.useLayoutEffect(e,t)},a.useMemo=function(e,t){return d.H.useMemo(e,t)},a.useOptimistic=function(e,t){return d.H.useOptimistic(e,t)},a.useReducer=function(e,t,u){return d.H.useReducer(e,t,u)},a.useRef=function(e){return d.H.useRef(e)},a.useState=function(e){return d.H.useState(e)},a.useSyncExternalStore=function(e,t,u){return d.H.useSyncExternalStore(e,t,u)},a.useTransition=function(){return d.H.useTransition()},a.version="19.2.0",a}var te;function de(){return te||(te=1,J.exports=fe()),J.exports}var ne=de();const Q=s=>window.growiFacade.react;async function pe(s){let n="";try{const o=await fetch(s);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const c=o.headers.get("Last-Modified");return n=await o.text(),n=n.replace(/,{2,}/g,","),{stats:JSON.parse(n),lastModified:c}}catch(o){throw o instanceof SyntaxError?(console.error("Failed to parse JSON after comma fix:",o),console.error("Fixed response was:",n),new Error(`JSON parse error: ${o.message}`)):o}}const xe="/__gpustat__";function me(){const s=Q(),{useState:n,useCallback:o,useEffect:c}=s,[l,f]=n([]),[y,j]=n(null),[v,g]=n(null),[A,E]=n(null),w=o(async()=>{j(null);try{const{stats:N,lastModified:_}=await pe(xe);f(N),E(_),g(new Date)}catch(N){console.error(N),j("Failed to fetch GPU stats.")}},[]);return c(()=>{w();const N=setInterval(w,3e4);return()=>clearInterval(N)},[w]),{stats:l,error:y,lastClientUpdate:v,lastApiUpdate:A,refresh:w}}const oe=ne.createContext(null);function he({children:s}){const n=me();return r.jsx(oe.Provider,{value:n,children:s})}const re=s=>s!=null;function ye({stats:s}){return r.jsx("div",{className:"overflow-x-auto w-full",children:r.jsxs("table",{className:"w-full bg-white text-3xl",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"サーバ"}),r.jsx("th",{className:"py-4 px-2 border-b-2 border-stone-200",children:"GPU"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"温度"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"計算負荷"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"メモリ (GiB)"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"利用者"})]})}),r.jsx("tbody",{children:s.map(n=>n.gpus.map((o,c)=>{const f=`py-4 px-4 ${c===n.gpus.length-1?"border-b-2 border-stone-200":""}`,y=`${f} text-center`,j=o.name?.replace("Ada Generation","Ada");return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:f,children:c===0?n.hostname:""}),r.jsx("td",{className:f,children:j}),r.jsxs("td",{className:y,children:[o["temperature.gpu"]," °C"]}),r.jsxs("td",{className:y,children:[o["utilization.gpu"]," %"]}),r.jsx("td",{className:y,children:(()=>{const v=o["memory.used"],g=o["memory.total"],A=re(v)?(v/1024).toFixed(1):"N/A",E=re(g)?(g/1024).toFixed(1):"N/A";return`${A} / ${E}`})()}),r.jsx("td",{className:f,children:o.processes?.map(v=>{const g=v.gpu_memory_usage?(v.gpu_memory_usage/1024).toFixed(1):"N/A";return`${v.username} (${g}GiB)`}).join(", ")})]},`${n.hostname}-${o.uuid}`)}))})]})})}const W=s=>{const n=(1-s/100)*160,[o,c,l]=ve(n,.85,.9);return`hsl(${o}, ${c}%, ${l}%)`},ve=(s,n,o)=>{const c=o*(2-n)/2,l=(o-c)/Math.min(c,1-c);return[s,l*100,c*100]},se=({value:s=75,min:n=0,max:o=100,startAngle:c=-135,endAngle:l=135,size:f=250,strokeWidth:y=20,label:j="Performance",subLabel:v,unit:g="%",showTicks:A=!0,tickCount:E=10,colors:w=W})=>{const N=ne.useId(),_=`gaugeGradient-${N}`,m=`shadow-${N}`,k=Math.max(n,Math.min(o,s)),P=(k-n)/(o-n)*100,I=l-c,b=f/2,G=(f-y)/2,L=I/360*2*Math.PI*G,D=L*(1-P/100),d=(S,C=G)=>{const R=(S-90)*Math.PI/180;return{x:b+C*Math.cos(R),y:b+C*Math.sin(R)}},Y=(S,C,R=G)=>{const O=d(S,R),H=d(C,R),$=C-S<=180?"0":"1";return`M ${O.x} ${O.y} A ${R} ${R} 0 ${$} 1 ${H.x} ${H.y}`},q=()=>{if(!A)return[];const S=[];for(let C=0;C<=E;C++){const R=c+I*C/E,O=d(R,G+5),H=d(R,G+15),$=d(R,G+25),U=n+(o-n)*C/E;S.push(r.jsxs("g",{children:[r.jsx("line",{x1:O.x,y1:O.y,x2:H.x,y2:H.y,stroke:"#94a3b8",strokeWidth:"2"}),r.jsx("text",{x:$.x,y:$.y,textAnchor:"middle",dominantBaseline:"middle",className:"text-xs fill-slate-600",children:Math.round(U)})]},`tick-${C}`))}return S},V=w(P);return r.jsx("div",{className:"flex flex-col items-center py-6 px-8",children:r.jsxs("svg",{width:f,height:f,className:"transform -rotate-0",style:{overflow:"visible"},children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:_,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[r.jsx("stop",{offset:"0%",stopColor:V,stopOpacity:"0.8"}),r.jsx("stop",{offset:"100%",stopColor:V,stopOpacity:"1"})]}),r.jsx("filter",{id:m,children:r.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodOpacity:"0.2"})})]}),q(),r.jsx("path",{d:Y(c,l),fill:"none",stroke:"#e5e7eb",strokeWidth:y,strokeLinecap:"round"}),r.jsx("path",{d:Y(c,l),fill:"none",stroke:`url(#${_})`,strokeWidth:y,strokeLinecap:"round",filter:`url(#${m})`,strokeDasharray:L,strokeDashoffset:D,style:{transition:"stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}}),r.jsxs("text",{x:b,y:b-(v?20:10),textAnchor:"middle",dominantBaseline:"middle",className:"text-4xl font-bold fill-slate-800",children:[k.toFixed(1),r.jsx("tspan",{className:"text-2xl fill-slate-600",children:g})]}),v&&r.jsx("text",{x:b,y:b+15,textAnchor:"middle",dominantBaseline:"middle",className:"text-xl font-bold fill-slate-500",children:v}),r.jsx("text",{x:b,y:b+(v?40:20),textAnchor:"middle",dominantBaseline:"middle",className:"text-sm fill-slate-500",children:j})]})})},_e=({processes:s})=>{const n=c=>c?(c/1024).toFixed(1):"N/A",o=s?.map(c=>`${c.username||"Unknown"} (${n(c.gpu_memory_usage)}GB)`).join(", ");return r.jsxs("div",{className:"flex flex-col",children:[r.jsx("div",{className:"px-4 py-1 mb-2 text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Processes"}),r.jsx("div",{className:"px-4 py-2 mb-8 text-xl flex-1 border-l-2 border-gray-300 box-border",children:o})]})},je="_container_gxmp0_1",ge="_header_gxmp0_10",Ee="_gpuName_gxmp0_14",we="_gauges_gxmp0_19",B={container:je,header:ge,gpuName:Ee,gauges:we},Ne=({value:s=50,min:n=0,max:o=100,height:c=200,width:l=20,animated:f=!0})=>{const y=Q(),{useState:j,useEffect:v}=y,[g,A]=j(s),E=Math.max(0,Math.min(100,(g-n)/(o-n)*100)),w=_=>{const k=Math.min(100,_/85*100);return W(k)},N=_=>_<=0?w(0):`linear-gradient(to top in oklch, ${Array.from({length:15},(P,I)=>{const b=I/14*_;return w(b)}).join(", ")})`;return v(()=>{A(s)},[s]),r.jsxs("div",{className:"flex flex-col items-center gap-4 p-4",children:[r.jsxs("div",{className:"relative flex items-start gap-4",style:{height:`${c}px`},children:[r.jsxs("div",{className:"relative",style:{width:`${l}px`,height:"100%"},children:[r.jsx("div",{className:"absolute inset-0 bg-gray-200"}),r.jsx("div",{className:`absolute bottom-0 left-0 right-0 ${f?"transition-all duration-500 ease-in-out":""}`,style:{height:`${E}%`,background:N(E)}})]}),r.jsx("div",{className:"relative h-full",children:[0,25,50,75,100].map(_=>r.jsxs("div",{className:"absolute flex items-center gap-1",style:{bottom:`${_}%`,transform:"translateY(50%)",left:"-12px"},children:[r.jsx("div",{className:"w-3 h-0.5 bg-gray-400"}),r.jsx("span",{className:"text-xs text-gray-600 font-medium",children:Math.round(n+(o-n)*_/100)})]},_))})]}),r.jsx("div",{className:"text-center",children:r.jsxs("div",{className:"text-3xl font-bold",style:{color:W(E)},children:[g.toFixed(1),"°C"]})})]})};function be({gpu:s}){const n=s["utilization.gpu"]??0,o=s["memory.used"]??0,c=s["memory.total"]??0,l=s["temperature.gpu"]??0,f=s["power.draw"]??0;return console.log(s.name,s.index),r.jsxs("div",{className:B.container,children:[r.jsx("div",{className:B.header,children:r.jsxs("h3",{className:B.gpuName,children:["GPU ",s.index,": ",s.name]})}),r.jsxs("div",{className:B.gauges,children:[r.jsx("div",{}),r.jsx(Ne,{value:l,max:100,height:200}),r.jsx("div",{}),r.jsx(se,{value:n,subLabel:`${f}W`,label:"GPU Utilization",unit:"%"}),r.jsx("div",{}),r.jsx(se,{value:o/1024,max:c/1024,label:"Memory",unit:"GiB"}),r.jsx("div",{}),r.jsx(_e,{processes:s.processes}),r.jsx("div",{})]})]})}function Re({stat:s}){return r.jsx("div",{children:s.gpus.map(n=>r.jsx(be,{gpu:n},n.index))})}const Te=()=>{const s=Q(),{useState:n,useContext:o}=s,c=o(oe),[l,f]=n("all");if(!c)throw new Error("GpuStatusDisplay must be used within a GpuStatsProvider");const{stats:y,error:j,lastApiUpdate:v,refresh:g}=c,A=["all",...new Set(y.map(m=>m.hostname).filter(m=>m))],E=m=>m?m.toLocaleString():"N/A",w=m=>m?E(new Date(m)):"N/A",N=m=>`px-4 py-2 text-2xl font-semibold border-b-2${l===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,_=l==="all"?null:y.find(m=>m.hostname===l);return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx("button",{onClick:g,className:"p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-gray-400",children:r.jsx("img",{src:"/refresh.svg",alt:"Refresh",className:"w-6 h-6"})}),r.jsx("div",{className:"ml-1 text-lg text-gray-600",children:r.jsxs("p",{className:"m-0",children:["Last Updated: ",w(v)]})})]}),j&&r.jsx("p",{className:"text-red-500",children:j}),r.jsx("div",{className:"border-b-2 border-stone-200",children:r.jsx("nav",{className:"-mb-px flex","aria-label":"Tabs",children:A.map(m=>r.jsx("button",{onClick:()=>f(m),className:N(m),children:m==="all"?"All":m},m))})}),r.jsx("div",{className:"mt-4",children:l==="all"?r.jsx(ye,{stats:y}):_?r.jsx(Re,{stat:_}):r.jsx("p",{children:"Host not found."})})]})},Ce=()=>r.jsx(he,{children:r.jsx(Te,{})}),Ae=()=>{if(growiFacade==null||growiFacade.markdownRenderer==null)return;const{optionsGenerators:s}=growiFacade.markdownRenderer,n=s.customGenerateViewOptions;s.customGenerateViewOptions=(...o)=>{const c=n?n(...o):s.generateViewOptions(...o),l=c.components.table;return c.components.table=f=>f.className?.includes("gpu-stat")?r.jsx(Ce,{...f}):r.jsx(l,{...f}),c}},Se=()=>{};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators["growi-plugin-gpu-stat"]={activate:Ae,deactivate:Se};
