var Y={exports:{}},H={},K={exports:{}},i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z;function le(){if(Z)return i;Z=1;var n=Symbol.for("react.element"),s=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),v=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),N=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),h=Symbol.iterator;function $(e){return e===null||typeof e!="object"?null:(e=h&&e[h]||e["@@iterator"],typeof e=="function"?e:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,u={};function P(e,r,l){this.props=e,this.context=r,this.refs=u,this.updater=l||S}P.prototype.isReactComponent={},P.prototype.setState=function(e,r){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,r,"setState")},P.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function M(){}M.prototype=P.prototype;function U(e,r,l){this.props=e,this.context=r,this.refs=u,this.updater=l||S}var C=U.prototype=new M;C.constructor=U,b(C,P.prototype),C.isPureReactComponent=!0;var I=Array.isArray,L=Object.prototype.hasOwnProperty,q={current:null},F={key:!0,ref:!0,__self:!0,__source:!0};function B(e,r,l){var m,f={},j=null,_=null;if(r!=null)for(m in r.ref!==void 0&&(_=r.ref),r.key!==void 0&&(j=""+r.key),r)L.call(r,m)&&!F.hasOwnProperty(m)&&(f[m]=r[m]);var g=arguments.length-2;if(g===1)f.children=l;else if(1<g){for(var y=Array(g),G=0;G<g;G++)y[G]=arguments[G+2];f.children=y}if(e&&e.defaultProps)for(m in g=e.defaultProps,g)f[m]===void 0&&(f[m]=g[m]);return{$$typeof:n,type:e,key:j,ref:_,props:f,_owner:q.current}}function W(e,r){return{$$typeof:n,type:e.type,key:r,ref:e.ref,props:e.props,_owner:e._owner}}function D(e){return typeof e=="object"&&e!==null&&e.$$typeof===n}function T(e){var r={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(l){return r[l]})}var E=/\/+/g;function k(e,r){return typeof e=="object"&&e!==null&&e.key!=null?T(""+e.key):r.toString(36)}function O(e,r,l,m,f){var j=typeof e;(j==="undefined"||j==="boolean")&&(e=null);var _=!1;if(e===null)_=!0;else switch(j){case"string":case"number":_=!0;break;case"object":switch(e.$$typeof){case n:case s:_=!0}}if(_)return _=e,f=f(_),e=m===""?"."+k(_,0):m,I(f)?(l="",e!=null&&(l=e.replace(E,"$&/")+"/"),O(f,r,l,"",function(G){return G})):f!=null&&(D(f)&&(f=W(f,l+(!f.key||_&&_.key===f.key?"":(""+f.key).replace(E,"$&/")+"/")+e)),r.push(f)),1;if(_=0,m=m===""?".":m+":",I(e))for(var g=0;g<e.length;g++){j=e[g];var y=m+k(j,g);_+=O(j,r,l,y,f)}else if(y=$(e),typeof y=="function")for(e=y.call(e),g=0;!(j=e.next()).done;)j=j.value,y=m+k(j,g++),_+=O(j,r,l,y,f);else if(j==="object")throw r=String(e),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return _}function A(e,r,l){if(e==null)return e;var m=[],f=0;return O(e,m,"","",function(j){return r.call(l,j,f++)}),m}function V(e){if(e._status===-1){var r=e._result;r=r(),r.then(function(l){(e._status===0||e._status===-1)&&(e._status=1,e._result=l)},function(l){(e._status===0||e._status===-1)&&(e._status=2,e._result=l)}),e._status===-1&&(e._status=0,e._result=r)}if(e._status===1)return e._result.default;throw e._result}var R={current:null},J={transition:null},ce={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:J,ReactCurrentOwner:q};return i.Children={map:A,forEach:function(e,r,l){A(e,function(){r.apply(this,arguments)},l)},count:function(e){var r=0;return A(e,function(){r++}),r},toArray:function(e){return A(e,function(r){return r})||[]},only:function(e){if(!D(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},i.Component=P,i.Fragment=o,i.Profiler=d,i.PureComponent=U,i.StrictMode=a,i.Suspense=c,i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ce,i.cloneElement=function(e,r,l){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var m=b({},e.props),f=e.key,j=e.ref,_=e._owner;if(r!=null){if(r.ref!==void 0&&(j=r.ref,_=q.current),r.key!==void 0&&(f=""+r.key),e.type&&e.type.defaultProps)var g=e.type.defaultProps;for(y in r)L.call(r,y)&&!F.hasOwnProperty(y)&&(m[y]=r[y]===void 0&&g!==void 0?g[y]:r[y])}var y=arguments.length-2;if(y===1)m.children=l;else if(1<y){g=Array(y);for(var G=0;G<y;G++)g[G]=arguments[G+2];m.children=g}return{$$typeof:n,type:e.type,key:f,ref:j,props:m,_owner:_}},i.createContext=function(e){return e={$$typeof:v,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:p,_context:e},e.Consumer=e},i.createElement=B,i.createFactory=function(e){var r=B.bind(null,e);return r.type=e,r},i.createRef=function(){return{current:null}},i.forwardRef=function(e){return{$$typeof:w,render:e}},i.isValidElement=D,i.lazy=function(e){return{$$typeof:x,_payload:{_status:-1,_result:e},_init:V}},i.memo=function(e,r){return{$$typeof:N,type:e,compare:r===void 0?null:r}},i.startTransition=function(e){var r=J.transition;J.transition={};try{e()}finally{J.transition=r}},i.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},i.useCallback=function(e,r){return R.current.useCallback(e,r)},i.useContext=function(e){return R.current.useContext(e)},i.useDebugValue=function(){},i.useDeferredValue=function(e){return R.current.useDeferredValue(e)},i.useEffect=function(e,r){return R.current.useEffect(e,r)},i.useId=function(){return R.current.useId()},i.useImperativeHandle=function(e,r,l){return R.current.useImperativeHandle(e,r,l)},i.useInsertionEffect=function(e,r){return R.current.useInsertionEffect(e,r)},i.useLayoutEffect=function(e,r){return R.current.useLayoutEffect(e,r)},i.useMemo=function(e,r){return R.current.useMemo(e,r)},i.useReducer=function(e,r,l){return R.current.useReducer(e,r,l)},i.useRef=function(e){return R.current.useRef(e)},i.useState=function(e){return R.current.useState(e)},i.useSyncExternalStore=function(e,r,l){return R.current.useSyncExternalStore(e,r,l)},i.useTransition=function(){return R.current.useTransition()},i.version="18.2.0",i}var ee;function oe(){return ee||(ee=1,K.exports=le()),K.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te;function ue(){if(te)return H;te=1;var n=oe(),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,d=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function v(w,c,N){var x,h={},$=null,S=null;N!==void 0&&($=""+N),c.key!==void 0&&($=""+c.key),c.ref!==void 0&&(S=c.ref);for(x in c)a.call(c,x)&&!p.hasOwnProperty(x)&&(h[x]=c[x]);if(w&&w.defaultProps)for(x in c=w.defaultProps,c)h[x]===void 0&&(h[x]=c[x]);return{$$typeof:s,type:w,key:$,ref:S,props:h,_owner:d.current}}return H.Fragment=o,H.jsx=v,H.jsxs=v,H}var re;function de(){return re||(re=1,Y.exports=ue()),Y.exports}var t=de(),ae=oe();const X=n=>window.growiFacade.react;async function fe(n){let s="";try{const o=await fetch(n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=o.headers.get("Last-Modified");return s=await o.text(),s=s.replace(/,{2,}/g,","),{stats:JSON.parse(s),lastModified:a}}catch(o){throw o instanceof SyntaxError?(console.error("Failed to parse JSON after comma fix:",o),console.error("Fixed response was:",s),new Error(`JSON parse error: ${o.message}`)):o}}const pe="/__gpustat__";function me(){const n=X(),{useState:s,useCallback:o,useEffect:a}=n,[d,p]=s([]),[v,w]=s(null),[c,N]=s(null),[x,h]=s(null),$=o(async()=>{w(null);try{const{stats:S,lastModified:b}=await fe(pe);p(S),h(b),N(new Date)}catch(S){console.error(S),w("Failed to fetch GPU stats.")}},[]);return a(()=>{$();const S=setInterval($,3e4);return()=>clearInterval(S)},[$]),{stats:d,error:v,lastClientUpdate:c,lastApiUpdate:x,refresh:$}}const ie=ae.createContext(null);function xe({children:n}){const s=me();return t.jsx(ie.Provider,{value:s,children:n})}const ne=n=>n!=null;function he({stats:n}){return t.jsx("div",{className:"overflow-x-auto w-full",children:t.jsxs("table",{className:"w-full bg-white text-3xl",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"サーバ"}),t.jsx("th",{className:"py-4 px-2 border-b-2 border-stone-200",children:"GPU"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"温度"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"計算負荷"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"メモリ (GiB)"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"利用者"})]})}),t.jsx("tbody",{children:n.map(s=>s.gpus.map((o,a)=>{const p=`py-4 px-4 ${a===s.gpus.length-1?"border-b-2 border-stone-200":""}`,v=`${p} text-center`,w=o.name?.replace("Ada Generation","Ada");return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:p,children:a===0?s.hostname:""}),t.jsx("td",{className:p,children:w}),t.jsxs("td",{className:v,children:[o["temperature.gpu"]," °C"]}),t.jsxs("td",{className:v,children:[o["utilization.gpu"]," %"]}),t.jsx("td",{className:v,children:(()=>{const c=o["memory.used"],N=o["memory.total"],x=ne(c)?(c/1024).toFixed(1):"N/A",h=ne(N)?(N/1024).toFixed(1):"N/A";return`${x} / ${h}`})()}),t.jsx("td",{className:p,children:o.processes?.map(c=>{const N=c.gpu_memory_usage?(c.gpu_memory_usage/1024).toFixed(1):"N/A";return`${c.username} (${N}GiB)`}).join(", ")})]},`${s.hostname}-${o.uuid}`)}))})]})})}const Q=n=>{const s=(1-n/100)*160,[o,a,d]=ye(s,.85,.9);return`hsl(${o}, ${a}%, ${d}%)`},ye=(n,s,o)=>{const a=o*(2-s)/2,d=(o-a)/Math.min(a,1-a);return[n,d*100,a*100]},se=({value:n=75,min:s=0,max:o=100,startAngle:a=-135,endAngle:d=135,size:p=250,strokeWidth:v=20,label:w="Performance",subLabel:c,unit:N="%",showTicks:x=!0,tickCount:h=10,colors:$=Q})=>{const S=ae.useId(),b=`gaugeGradient-${S}`,u=`shadow-${S}`,P=Math.max(s,Math.min(o,n)),M=(P-s)/(o-s)*100,U=d-a,C=p/2,I=(p-v)/2,L=U/360*2*Math.PI*I,q=L*(1-M/100),F=(T,E=I)=>{const k=(T-90)*Math.PI/180;return{x:C+E*Math.cos(k),y:C+E*Math.sin(k)}},B=(T,E,k=I)=>{const O=F(T,k),A=F(E,k),V=E-T<=180?"0":"1";return`M ${O.x} ${O.y} A ${k} ${k} 0 ${V} 1 ${A.x} ${A.y}`},W=()=>{if(!x)return[];const T=[];for(let E=0;E<=h;E++){const k=a+U*E/h,O=F(k,I+5),A=F(k,I+15),V=F(k,I+25),R=s+(o-s)*E/h;T.push(t.jsxs("g",{children:[t.jsx("line",{x1:O.x,y1:O.y,x2:A.x,y2:A.y,stroke:"#94a3b8",strokeWidth:"2"}),t.jsx("text",{x:V.x,y:V.y,textAnchor:"middle",dominantBaseline:"middle",className:"text-xs fill-slate-600",children:Math.round(R)})]},`tick-${E}`))}return T},D=$(M);return t.jsx("div",{className:"flex flex-col items-center py-6 px-8",children:t.jsxs("svg",{width:p,height:p,className:"transform -rotate-0",style:{overflow:"visible"},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:b,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:D,stopOpacity:"0.8"}),t.jsx("stop",{offset:"100%",stopColor:D,stopOpacity:"1"})]}),t.jsx("filter",{id:u,children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodOpacity:"0.2"})})]}),W(),t.jsx("path",{d:B(a,d),fill:"none",stroke:"#e5e7eb",strokeWidth:v,strokeLinecap:"round"}),t.jsx("path",{d:B(a,d),fill:"none",stroke:`url(#${b})`,strokeWidth:v,strokeLinecap:"round",filter:`url(#${u})`,strokeDasharray:L,strokeDashoffset:q,style:{transition:"stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}}),t.jsxs("text",{x:C,y:C-(c?20:10),textAnchor:"middle",dominantBaseline:"middle",className:"text-4xl font-bold fill-slate-800",children:[P.toFixed(1),t.jsx("tspan",{className:"text-2xl fill-slate-600",children:N})]}),c&&t.jsx("text",{x:C,y:C+15,textAnchor:"middle",dominantBaseline:"middle",className:"text-xl font-bold fill-slate-500",children:c}),t.jsx("text",{x:C,y:C+(c?40:20),textAnchor:"middle",dominantBaseline:"middle",className:"text-sm fill-slate-500",children:w})]})})},ve=({processes:n})=>{const s=a=>a?(a/1024).toFixed(1):"N/A",o=n?.map(a=>`${a.username||"Unknown"} (${s(a.gpu_memory_usage)}GB)`).join(", ");return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"px-4 py-1 mb-2 text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Processes"}),t.jsx("div",{className:"px-4 py-2 mb-8 text-xl flex-1 border-l-2 border-gray-300 box-border",children:o})]})},je="_container_gxmp0_1",ge="_header_gxmp0_10",be="_gpuName_gxmp0_14",_e="_gauges_gxmp0_19",z={container:je,header:ge,gpuName:be,gauges:_e},we=({value:n=50,min:s=0,max:o=100,height:a=200,width:d=20,animated:p=!0})=>{const v=X(),{useState:w,useEffect:c}=v,[N,x]=w(n),h=Math.max(0,Math.min(100,(N-s)/(o-s)*100)),$=b=>{const P=Math.min(100,b/85*100);return Q(P)},S=b=>b<=0?$(0):`linear-gradient(to top in oklch, ${Array.from({length:15},(M,U)=>{const C=U/14*b;return $(C)}).join(", ")})`;return c(()=>{x(n)},[n]),t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4",children:[t.jsxs("div",{className:"relative flex items-start gap-4",style:{height:`${a}px`},children:[t.jsxs("div",{className:"relative",style:{width:`${d}px`,height:"100%"},children:[t.jsx("div",{className:"absolute inset-0 bg-gray-200"}),t.jsx("div",{className:`absolute bottom-0 left-0 right-0 ${p?"transition-all duration-500 ease-in-out":""}`,style:{height:`${h}%`,background:S(h)}})]}),t.jsx("div",{className:"relative h-full",children:[0,25,50,75,100].map(b=>t.jsxs("div",{className:"absolute flex items-center gap-1",style:{bottom:`${b}%`,transform:"translateY(50%)",left:"-12px"},children:[t.jsx("div",{className:"w-3 h-0.5 bg-gray-400"}),t.jsx("span",{className:"text-xs text-gray-600 font-medium",children:Math.round(s+(o-s)*b/100)})]},b))})]}),t.jsx("div",{className:"text-center",children:t.jsxs("div",{className:"text-3xl font-bold",style:{color:Q(h)},children:[N.toFixed(1),"°C"]})})]})};function Ne({gpu:n}){const s=n["utilization.gpu"]??0,o=n["memory.used"]??0,a=n["memory.total"]??0,d=n["temperature.gpu"]??0,p=n["power.draw"]??0;return console.log(n.name,n.index),t.jsxs("div",{className:z.container,children:[t.jsx("div",{className:z.header,children:t.jsxs("h3",{className:z.gpuName,children:["GPU ",n.index,": ",n.name]})}),t.jsxs("div",{className:z.gauges,children:[t.jsx("div",{}),t.jsx(we,{value:d,max:100,height:200}),t.jsx("div",{}),t.jsx(se,{value:s,subLabel:`${p}W`,label:"GPU Utilization",unit:"%"}),t.jsx("div",{}),t.jsx(se,{value:o/1024,max:a/1024,label:"Memory",unit:"GiB"}),t.jsx("div",{}),t.jsx(ve,{processes:n.processes}),t.jsx("div",{})]})]})}function Se({stat:n}){return t.jsx("div",{children:n.gpus.map(s=>t.jsx(Ne,{gpu:s},s.index))})}const $e=()=>{const n=X(),{useState:s,useContext:o}=n,a=o(ie),[d,p]=s("all");if(!a)throw new Error("GpuStatusDisplay must be used within a GpuStatsProvider");const{stats:v,error:w,lastApiUpdate:c,refresh:N}=a,x=["all",...new Set(v.map(u=>u.hostname).filter(u=>u))],h=u=>u?u.toLocaleString():"N/A",$=u=>u?h(new Date(u)):"N/A",S=u=>`px-4 py-2 text-2xl font-semibold border-b-2${d===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,b=d==="all"?null:v.find(u=>u.hostname===d);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("button",{onClick:N,className:"p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-gray-400",children:t.jsx("img",{src:"/refresh.svg",alt:"Refresh",className:"w-6 h-6"})}),t.jsx("div",{className:"ml-1 text-lg text-gray-600",children:t.jsxs("p",{className:"m-0",children:["Last Updated: ",$(c)]})})]}),w&&t.jsx("p",{className:"text-red-500",children:w}),t.jsx("div",{className:"border-b-2 border-stone-200",children:t.jsx("nav",{className:"-mb-px flex","aria-label":"Tabs",children:x.map(u=>t.jsx("button",{onClick:()=>p(u),className:S(u),children:u==="all"?"All":u},u))})}),t.jsx("div",{className:"mt-4",children:d==="all"?t.jsx(he,{stats:v}):b?t.jsx(Se,{stat:b}):t.jsx("p",{children:"Host not found."})})]})},Re=()=>t.jsx(xe,{children:t.jsx($e,{})}),ke=()=>{if(growiFacade==null||growiFacade.markdownRenderer==null)return;const{optionsGenerators:n}=growiFacade.markdownRenderer,s=n.customGenerateViewOptions;n.customGenerateViewOptions=(...o)=>{const a=s?s(...o):n.generateViewOptions(...o),d=a.components.table;return a.components.table=p=>p.className?.includes("gpu-stat")?t.jsx(Re,{...p}):t.jsx(d,{...p}),a}},Ce=()=>{};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators["growi-plugin-gpu-stat"]={activate:ke,deactivate:Ce};
