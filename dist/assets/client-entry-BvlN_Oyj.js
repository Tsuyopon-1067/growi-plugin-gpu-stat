var Q={exports:{}},z={},X={exports:{}},c={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee;function ie(){if(ee)return c;ee=1;var n=Symbol.for("react.element"),s=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),j=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),i=Symbol.for("react.suspense"),N=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),h=Symbol.iterator;function $(e){return e===null||typeof e!="object"?null:(e=h&&e[h]||e["@@iterator"],typeof e=="function"?e:null)}var R={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,u={};function E(e,r,l){this.props=e,this.context=r,this.refs=u,this.updater=l||R}E.prototype.isReactComponent={},E.prototype.setState=function(e,r){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,r,"setState")},E.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function D(){}D.prototype=E.prototype;function T(e,r,l){this.props=e,this.context=r,this.refs=u,this.updater=l||R}var U=T.prototype=new D;U.constructor=T,S(U,E.prototype),U.isPureReactComponent=!0;var L=Array.isArray,P=Object.prototype.hasOwnProperty,I={current:null},q={key:!0,ref:!0,__self:!0,__source:!0};function H(e,r,l){var x,f={},g=null,_=null;if(r!=null)for(x in r.ref!==void 0&&(_=r.ref),r.key!==void 0&&(g=""+r.key),r)P.call(r,x)&&!q.hasOwnProperty(x)&&(f[x]=r[x]);var b=arguments.length-2;if(b===1)f.children=l;else if(1<b){for(var v=Array(b),O=0;O<b;O++)v[O]=arguments[O+2];f.children=v}if(e&&e.defaultProps)for(x in b=e.defaultProps,b)f[x]===void 0&&(f[x]=b[x]);return{$$typeof:n,type:e,key:g,ref:_,props:f,_owner:I.current}}function F(e,r){return{$$typeof:n,type:e.type,key:r,ref:e.ref,props:e.props,_owner:e._owner}}function V(e){return typeof e=="object"&&e!==null&&e.$$typeof===n}function Y(e){var r={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(l){return r[l]})}var B=/\/+/g;function G(e,r){return typeof e=="object"&&e!==null&&e.key!=null?Y(""+e.key):r.toString(36)}function k(e,r,l,x,f){var g=typeof e;(g==="undefined"||g==="boolean")&&(e=null);var _=!1;if(e===null)_=!0;else switch(g){case"string":case"number":_=!0;break;case"object":switch(e.$$typeof){case n:case s:_=!0}}if(_)return _=e,f=f(_),e=x===""?"."+G(_,0):x,L(f)?(l="",e!=null&&(l=e.replace(B,"$&/")+"/"),k(f,r,l,"",function(O){return O})):f!=null&&(V(f)&&(f=F(f,l+(!f.key||_&&_.key===f.key?"":(""+f.key).replace(B,"$&/")+"/")+e)),r.push(f)),1;if(_=0,x=x===""?".":x+":",L(e))for(var b=0;b<e.length;b++){g=e[b];var v=x+G(g,b);_+=k(g,r,l,v,f)}else if(v=$(e),typeof v=="function")for(e=v.call(e),b=0;!(g=e.next()).done;)g=g.value,v=x+G(g,b++),_+=k(g,r,l,v,f);else if(g==="object")throw r=String(e),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return _}function C(e,r,l){if(e==null)return e;var x=[],f=0;return k(e,x,"","",function(g){return r.call(l,g,f++)}),x}function M(e){if(e._status===-1){var r=e._result;r=r(),r.then(function(l){(e._status===0||e._status===-1)&&(e._status=1,e._result=l)},function(l){(e._status===0||e._status===-1)&&(e._status=2,e._result=l)}),e._status===-1&&(e._status=0,e._result=r)}if(e._status===1)return e._result.default;throw e._result}var y={current:null},A={transition:null},K={ReactCurrentDispatcher:y,ReactCurrentBatchConfig:A,ReactCurrentOwner:I};return c.Children={map:C,forEach:function(e,r,l){C(e,function(){r.apply(this,arguments)},l)},count:function(e){var r=0;return C(e,function(){r++}),r},toArray:function(e){return C(e,function(r){return r})||[]},only:function(e){if(!V(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},c.Component=E,c.Fragment=o,c.Profiler=d,c.PureComponent=T,c.StrictMode=a,c.Suspense=i,c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K,c.cloneElement=function(e,r,l){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var x=S({},e.props),f=e.key,g=e.ref,_=e._owner;if(r!=null){if(r.ref!==void 0&&(g=r.ref,_=I.current),r.key!==void 0&&(f=""+r.key),e.type&&e.type.defaultProps)var b=e.type.defaultProps;for(v in r)P.call(r,v)&&!q.hasOwnProperty(v)&&(x[v]=r[v]===void 0&&b!==void 0?b[v]:r[v])}var v=arguments.length-2;if(v===1)x.children=l;else if(1<v){b=Array(v);for(var O=0;O<v;O++)b[O]=arguments[O+2];x.children=b}return{$$typeof:n,type:e.type,key:f,ref:g,props:x,_owner:_}},c.createContext=function(e){return e={$$typeof:j,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:p,_context:e},e.Consumer=e},c.createElement=H,c.createFactory=function(e){var r=H.bind(null,e);return r.type=e,r},c.createRef=function(){return{current:null}},c.forwardRef=function(e){return{$$typeof:w,render:e}},c.isValidElement=V,c.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:M}},c.memo=function(e,r){return{$$typeof:N,type:e,compare:r===void 0?null:r}},c.startTransition=function(e){var r=A.transition;A.transition={};try{e()}finally{A.transition=r}},c.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},c.useCallback=function(e,r){return y.current.useCallback(e,r)},c.useContext=function(e){return y.current.useContext(e)},c.useDebugValue=function(){},c.useDeferredValue=function(e){return y.current.useDeferredValue(e)},c.useEffect=function(e,r){return y.current.useEffect(e,r)},c.useId=function(){return y.current.useId()},c.useImperativeHandle=function(e,r,l){return y.current.useImperativeHandle(e,r,l)},c.useInsertionEffect=function(e,r){return y.current.useInsertionEffect(e,r)},c.useLayoutEffect=function(e,r){return y.current.useLayoutEffect(e,r)},c.useMemo=function(e,r){return y.current.useMemo(e,r)},c.useReducer=function(e,r,l){return y.current.useReducer(e,r,l)},c.useRef=function(e){return y.current.useRef(e)},c.useState=function(e){return y.current.useState(e)},c.useSyncExternalStore=function(e,r,l){return y.current.useSyncExternalStore(e,r,l)},c.useTransition=function(){return y.current.useTransition()},c.version="18.2.0",c}var te;function ae(){return te||(te=1,X.exports=ie()),X.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var re;function le(){if(re)return z;re=1;var n=ae(),s=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,d=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function j(w,i,N){var m,h={},$=null,R=null;N!==void 0&&($=""+N),i.key!==void 0&&($=""+i.key),i.ref!==void 0&&(R=i.ref);for(m in i)a.call(i,m)&&!p.hasOwnProperty(m)&&(h[m]=i[m]);if(w&&w.defaultProps)for(m in i=w.defaultProps,i)h[m]===void 0&&(h[m]=i[m]);return{$$typeof:s,type:w,key:$,ref:R,props:h,_owner:d.current}}return z.Fragment=o,z.jsx=j,z.jsxs=j,z}var ne;function ue(){return ne||(ne=1,Q.exports=le()),Q.exports}var t=ue(),de=ae();const W=n=>window.growiFacade.react;async function fe(n){let s="";try{const o=await fetch(n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=o.headers.get("Last-Modified");return s=await o.text(),s=s.replace(/,{2,}/g,","),{stats:JSON.parse(s),lastModified:a}}catch(o){throw o instanceof SyntaxError?(console.error("Failed to parse JSON after comma fix:",o),console.error("Fixed response was:",s),new Error(`JSON parse error: ${o.message}`)):o}}const pe="/__gpustat__";function xe(){const n=W(),{useState:s,useCallback:o,useEffect:a}=n,[d,p]=s([]),[j,w]=s(null),[i,N]=s(null),[m,h]=s(null),$=o(async()=>{w(null);try{const{stats:R,lastModified:S}=await fe(pe);p(R),h(S),N(new Date)}catch(R){console.error(R),w("Failed to fetch GPU stats.")}},[]);return a(()=>{$();const R=setInterval($,3e4);return()=>clearInterval(R)},[$]),{stats:d,error:j,lastClientUpdate:i,lastApiUpdate:m,refresh:$}}const ce=de.createContext(null);function me({children:n}){const s=xe();return t.jsx(ce.Provider,{value:s,children:n})}const se=n=>n!=null;function he({stats:n}){return t.jsx("div",{className:"overflow-x-auto w-full",children:t.jsxs("table",{className:"w-full bg-white text-3xl",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"サーバ"}),t.jsx("th",{className:"py-4 px-2 border-b-2 border-stone-200",children:"GPU"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"温度"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"計算負荷"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"メモリ (GiB)"}),t.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"利用者"})]})}),t.jsx("tbody",{children:n.map(s=>s.gpus.map((o,a)=>{const p=`py-4 px-4 ${a===s.gpus.length-1?"border-b-2 border-stone-200":""}`,j=`${p} text-center`,w=o.name?.replace("Ada Generation","Ada");return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:p,children:a===0?s.hostname:""}),t.jsx("td",{className:p,children:w}),t.jsxs("td",{className:j,children:[o["temperature.gpu"]," °C"]}),t.jsxs("td",{className:j,children:[o["utilization.gpu"]," %"]}),t.jsx("td",{className:j,children:(()=>{const i=o["memory.used"],N=o["memory.total"],m=se(i)?(i/1024).toFixed(1):"N/A",h=se(N)?(N/1024).toFixed(1):"N/A";return`${m} / ${h}`})()}),t.jsx("td",{className:p,children:o.processes?.map(i=>{const N=i.gpu_memory_usage?(i.gpu_memory_usage/1024).toFixed(1):"N/A";return`${i.username} (${N}GiB)`}).join(", ")})]},`${s.hostname}-${o.uuid}`)}))})]})})}const Z=n=>{const s=(1-n/100)*160,[o,a,d]=ye(s,.85,.9);return`hsl(${o}, ${a}%, ${d}%)`},ye=(n,s,o)=>{const a=o*(2-s)/2,d=(o-a)/Math.min(a,1-a);return[n,d*100,a*100]},oe=({value:n=75,min:s=0,max:o=100,startAngle:a=-135,endAngle:d=135,size:p=250,strokeWidth:j=20,label:w="Performance",subLabel:i,unit:N="%",showTicks:m=!0,tickCount:h=10,colors:$=Z})=>{const R=W(),{useId:S}=R,u=S(),E=`gaugeGradient-${u}`,D=`shadow-${u}`,T=Math.max(s,Math.min(o,n)),U=(T-s)/(o-s)*100,L=d-a,P=p/2,I=(p-j)/2,q=L/360*2*Math.PI*I,H=q*(1-U/100),F=(G,k=I)=>{const C=(G-90)*Math.PI/180;return{x:P+k*Math.cos(C),y:P+k*Math.sin(C)}},V=(G,k,C=I)=>{const M=F(G,C),y=F(k,C),A=k-G<=180?"0":"1";return`M ${M.x} ${M.y} A ${C} ${C} 0 ${A} 1 ${y.x} ${y.y}`},Y=()=>{if(!m)return[];const G=[];for(let k=0;k<=h;k++){const C=a+L*k/h,M=F(C,I+5),y=F(C,I+15),A=F(C,I+25),K=s+(o-s)*k/h;G.push(t.jsxs("g",{children:[t.jsx("line",{x1:M.x,y1:M.y,x2:y.x,y2:y.y,stroke:"#94a3b8",strokeWidth:"2"}),t.jsx("text",{x:A.x,y:A.y,textAnchor:"middle",dominantBaseline:"middle",className:"text-xs fill-slate-600",children:Math.round(K)})]},`tick-${k}`))}return G},B=$(U);return t.jsx("div",{className:"flex flex-col items-center py-6 px-8",children:t.jsxs("svg",{width:p,height:p,className:"transform -rotate-0",style:{overflow:"visible"},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:E,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[t.jsx("stop",{offset:"0%",stopColor:B,stopOpacity:"0.8"}),t.jsx("stop",{offset:"100%",stopColor:B,stopOpacity:"1"})]}),t.jsx("filter",{id:D,children:t.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodOpacity:"0.2"})})]}),Y(),t.jsx("path",{d:V(a,d),fill:"none",stroke:"#e5e7eb",strokeWidth:j,strokeLinecap:"round"}),t.jsx("path",{d:V(a,d),fill:"none",stroke:`url(#${E})`,strokeWidth:j,strokeLinecap:"round",filter:`url(#${D})`,strokeDasharray:q,strokeDashoffset:H,style:{transition:"stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}}),t.jsxs("text",{x:P,y:P-(i?20:10),textAnchor:"middle",dominantBaseline:"middle",className:"text-4xl font-bold fill-slate-800",children:[T.toFixed(1),t.jsx("tspan",{className:"text-2xl fill-slate-600",children:N})]}),i&&t.jsx("text",{x:P,y:P+15,textAnchor:"middle",dominantBaseline:"middle",className:"text-xl font-bold fill-slate-500",children:i}),t.jsx("text",{x:P,y:P+(i?40:20),textAnchor:"middle",dominantBaseline:"middle",className:"text-sm fill-slate-500",children:w})]})})},ve=({processes:n})=>{const s=a=>a?(a/1024).toFixed(1):"N/A",o=n?.map(a=>`${a.username||"Unknown"} (${s(a.gpu_memory_usage)}GB)`).join(", ");return t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"px-4 py-1 mb-2 text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Processes"}),t.jsx("div",{className:"px-4 py-2 mb-8 text-xl flex-1 border-l-2 border-gray-300 box-border",children:o})]})},je="_container_gxmp0_1",ge="_header_gxmp0_10",be="_gpuName_gxmp0_14",_e="_gauges_gxmp0_19",J={container:je,header:ge,gpuName:be,gauges:_e},we=({value:n=50,min:s=0,max:o=100,height:a=200,width:d=20,animated:p=!0})=>{const j=W(),{useState:w,useEffect:i}=j,[N,m]=w(n),h=Math.max(0,Math.min(100,(N-s)/(o-s)*100)),$=S=>{const E=Math.min(100,S/85*100);return Z(E)},R=S=>S<=0?$(0):`linear-gradient(to top in oklch, ${Array.from({length:15},(D,T)=>{const U=T/14*S;return $(U)}).join(", ")})`;return i(()=>{m(n)},[n]),t.jsxs("div",{className:"flex flex-col items-center gap-4 p-4",children:[t.jsxs("div",{className:"relative flex items-start gap-4",style:{height:`${a}px`},children:[t.jsxs("div",{className:"relative",style:{width:`${d}px`,height:"100%"},children:[t.jsx("div",{className:"absolute inset-0 bg-gray-200"}),t.jsx("div",{className:`absolute bottom-0 left-0 right-0 ${p?"transition-all duration-500 ease-in-out":""}`,style:{height:`${h}%`,background:R(h)}})]}),t.jsx("div",{className:"relative h-full",children:[0,25,50,75,100].map(S=>t.jsxs("div",{className:"absolute flex items-center gap-1",style:{bottom:`${S}%`,transform:"translateY(50%)",left:"-12px"},children:[t.jsx("div",{className:"w-3 h-0.5 bg-gray-400"}),t.jsx("span",{className:"text-xs text-gray-600 font-medium",children:Math.round(s+(o-s)*S/100)})]},S))})]}),t.jsx("div",{className:"text-center",children:t.jsxs("div",{className:"text-3xl font-bold",style:{color:Z(h)},children:[N.toFixed(1),"°C"]})})]})};function Ne({gpu:n}){const s=n["utilization.gpu"]??0,o=n["memory.used"]??0,a=n["memory.total"]??0,d=n["temperature.gpu"]??0,p=n["power.draw"]??0;return console.log(n.name,n.index),t.jsxs("div",{className:J.container,children:[t.jsx("div",{className:J.header,children:t.jsxs("h3",{className:J.gpuName,children:["GPU ",n.index,": ",n.name]})}),t.jsxs("div",{className:J.gauges,children:[t.jsx("div",{}),t.jsx(we,{value:d,max:100,height:200}),t.jsx("div",{}),t.jsx(oe,{value:s,subLabel:`${p}W`,label:"GPU Utilization",unit:"%"}),t.jsx("div",{}),t.jsx(oe,{value:o/1024,max:a/1024,label:"Memory",unit:"GiB"}),t.jsx("div",{}),t.jsx(ve,{processes:n.processes}),t.jsx("div",{})]})]})}function Se({stat:n}){return t.jsx("div",{children:n.gpus.map(s=>t.jsx(Ne,{gpu:s},s.index))})}const $e=n=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",enableBackground:"new 0 0 65 65",viewBox:"0 0 65 65",...n,children:t.jsx("g",{id:"Layer_3_copy_2",children:t.jsxs("g",{fill:"currentColor",children:[t.jsx("path",{d:"m32.5 4.999c-5.405 0-10.444 1.577-14.699 4.282l-5.75-5.75v16.11h16.11l-6.395-6.395c3.18-1.787 6.834-2.82 10.734-2.82 12.171 0 22.073 9.902 22.073 22.074 0 2.899-0.577 5.664-1.599 8.202l4.738 2.762c1.47-3.363 2.288-7.068 2.288-10.964 0-15.164-12.337-27.501-27.5-27.501z"}),t.jsx("path",{d:"m43.227 51.746c-3.179 1.786-6.826 2.827-10.726 2.827-12.171 0-22.073-9.902-22.073-22.073 0-2.739 0.524-5.35 1.439-7.771l-4.731-2.851c-1.375 3.271-2.136 6.858-2.136 10.622 0 15.164 12.336 27.5 27.5 27.5 5.406 0 10.434-1.584 14.691-4.289l5.758 5.759v-16.112h-16.111l6.389 6.388z"})]})})}),Re=()=>{const n=W(),{useState:s,useContext:o}=n,a=o(ce),[d,p]=s("all");if(!a)throw new Error("GpuStatusDisplay must be used within a GpuStatsProvider");const{stats:j,error:w,lastApiUpdate:i,refresh:N}=a,m=["all",...new Set(j.map(u=>u.hostname).filter(u=>u))],h=u=>u?u.toLocaleString():"N/A",$=u=>u?h(new Date(u)):"N/A",R=u=>`px-4 py-2 text-2xl font-semibold border-b-2${d===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,S=d==="all"?null:j.find(u=>u.hostname===d);return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("button",{onClick:N,className:"w-10 h-10 p-2 rounded-full hover:bg-gray-200 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-gray-400 flex items-center justify-center",style:{borderRadius:"50%"},children:t.jsx($e,{className:"w-6 h-6",color:"#2b7fff"})}),t.jsx("div",{className:"ml-1 text-lg text-gray-600",children:t.jsxs("p",{className:"m-0",children:["Last Updated: ",$(i)]})})]}),w&&t.jsx("p",{className:"text-red-500",children:w}),t.jsx("div",{className:"border-b-2 border-stone-200",children:t.jsx("nav",{className:"-mb-px flex","aria-label":"Tabs",children:m.map(u=>t.jsx("button",{onClick:()=>p(u),className:R(u),children:u==="all"?"All":u},u))})}),t.jsx("div",{className:"mt-4",children:d==="all"?t.jsx(he,{stats:j}):S?t.jsx(Se,{stat:S}):t.jsx("p",{children:"Host not found."})})]})},ke=()=>t.jsx(me,{children:t.jsx(Re,{})}),Ce=()=>{if(growiFacade==null||growiFacade.markdownRenderer==null)return;const{optionsGenerators:n}=growiFacade.markdownRenderer,s=n.customGenerateViewOptions;n.customGenerateViewOptions=(...o)=>{const a=s?s(...o):n.generateViewOptions(...o),d=a.components.table;return a.components.table=p=>p.className?.includes("gpu-stat")?t.jsx(ke,{...p}):t.jsx(d,{...p}),a}},Ee=()=>{};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators["growi-plugin-gpu-stat"]={activate:Ce,deactivate:Ee};
