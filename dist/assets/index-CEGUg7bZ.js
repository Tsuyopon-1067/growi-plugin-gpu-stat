(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const h of u.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function i(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerPolicy&&(u.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?u.credentials="include":n.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function l(n){if(n.ep)return;n.ep=!0;const u=i(n);fetch(n.href,u)}})();var z={exports:{}},F={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z;function ce(){if(Z)return F;Z=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function i(l,n,u){var h=null;if(u!==void 0&&(h=""+u),n.key!==void 0&&(h=""+n.key),"key"in n){u={};for(var _ in n)_!=="key"&&(u[_]=n[_])}else u=n;return n=u.ref,{$$typeof:o,type:l,key:h,ref:n!==void 0?n:null,props:u}}return F.Fragment=s,F.jsx=i,F.jsxs=i,F}var K;function le(){return K||(K=1,z.exports=ce()),z.exports}var r=le(),J={exports:{}},a={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee;function fe(){if(ee)return a;ee=1;var o=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),u=Symbol.for("react.consumer"),h=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),j=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),E=Symbol.for("react.activity"),N=Symbol.iterator;function w(e){return e===null||typeof e!="object"?null:(e=N&&e[N]||e["@@iterator"],typeof e=="function"?e:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,I={};function P(e,t,f){this.props=e,this.context=t,this.refs=I,this.updater=f||g}P.prototype.isReactComponent={},P.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},P.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function H(){}H.prototype=P.prototype;function b(e,t,f){this.props=e,this.context=t,this.refs=I,this.updater=f||g}var O=b.prototype=new H;O.constructor=b,x(O,P.prototype),O.isPureReactComponent=!0;var L=Array.isArray;function D(){}var d={H:null,A:null,T:null,S:null},Y=Object.prototype.hasOwnProperty;function q(e,t,f){var c=f.ref;return{$$typeof:o,type:e,key:t,ref:c!==void 0?c:null,props:f}}function V(e,t){return q(e.type,t,e.props)}function S(e){return typeof e=="object"&&e!==null&&e.$$typeof===o}function C(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(f){return t[f]})}var R=/\/+/g;function M(e,t){return typeof e=="object"&&e!==null&&e.key!=null?C(""+e.key):t.toString(36)}function k(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(D,D):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function $(e,t,f,c,p){var m=typeof e;(m==="undefined"||m==="boolean")&&(e=null);var y=!1;if(e===null)y=!0;else switch(m){case"bigint":case"string":case"number":y=!0;break;case"object":switch(e.$$typeof){case o:case s:y=!0;break;case A:return y=e._init,$(y(e._payload),t,f,c,p)}}if(y)return p=p(e),y=c===""?"."+M(e,0):c,L(p)?(f="",y!=null&&(f=y.replace(R,"$&/")+"/"),$(p,t,f,"",function(ue){return ue})):p!=null&&(S(p)&&(p=V(p,f+(p.key==null||e&&e.key===p.key?"":(""+p.key).replace(R,"$&/")+"/")+y)),t.push(p)),1;y=0;var G=c===""?".":c+":";if(L(e))for(var T=0;T<e.length;T++)c=e[T],m=G+M(c,T),y+=$(c,t,f,m,p);else if(T=w(e),typeof T=="function")for(e=T.call(e),T=0;!(c=e.next()).done;)c=c.value,m=G+M(c,T++),y+=$(c,t,f,m,p);else if(m==="object"){if(typeof e.then=="function")return $(k(e),t,f,c,p);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return y}function U(e,t,f){if(e==null)return e;var c=[],p=0;return $(e,c,"","",function(m){return t.call(f,m,p++)}),c}function ie(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(f){(e._status===0||e._status===-1)&&(e._status=1,e._result=f)},function(f){(e._status===0||e._status===-1)&&(e._status=2,e._result=f)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var X=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},ae={map:U,forEach:function(e,t,f){U(e,function(){t.apply(this,arguments)},f)},count:function(e){var t=0;return U(e,function(){t++}),t},toArray:function(e){return U(e,function(t){return t})||[]},only:function(e){if(!S(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return a.Activity=E,a.Children=ae,a.Component=P,a.Fragment=i,a.Profiler=n,a.PureComponent=b,a.StrictMode=l,a.Suspense=v,a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=d,a.__COMPILER_RUNTIME={__proto__:null,c:function(e){return d.H.useMemoCache(e)}},a.cache=function(e){return function(){return e.apply(null,arguments)}},a.cacheSignal=function(){return null},a.cloneElement=function(e,t,f){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var c=x({},e.props),p=e.key;if(t!=null)for(m in t.key!==void 0&&(p=""+t.key),t)!Y.call(t,m)||m==="key"||m==="__self"||m==="__source"||m==="ref"&&t.ref===void 0||(c[m]=t[m]);var m=arguments.length-2;if(m===1)c.children=f;else if(1<m){for(var y=Array(m),G=0;G<m;G++)y[G]=arguments[G+2];c.children=y}return q(e.type,p,c)},a.createContext=function(e){return e={$$typeof:h,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:u,_context:e},e},a.createElement=function(e,t,f){var c,p={},m=null;if(t!=null)for(c in t.key!==void 0&&(m=""+t.key),t)Y.call(t,c)&&c!=="key"&&c!=="__self"&&c!=="__source"&&(p[c]=t[c]);var y=arguments.length-2;if(y===1)p.children=f;else if(1<y){for(var G=Array(y),T=0;T<y;T++)G[T]=arguments[T+2];p.children=G}if(e&&e.defaultProps)for(c in y=e.defaultProps,y)p[c]===void 0&&(p[c]=y[c]);return q(e,m,p)},a.createRef=function(){return{current:null}},a.forwardRef=function(e){return{$$typeof:_,render:e}},a.isValidElement=S,a.lazy=function(e){return{$$typeof:A,_payload:{_status:-1,_result:e},_init:ie}},a.memo=function(e,t){return{$$typeof:j,type:e,compare:t===void 0?null:t}},a.startTransition=function(e){var t=d.T,f={};d.T=f;try{var c=e(),p=d.S;p!==null&&p(f,c),typeof c=="object"&&c!==null&&typeof c.then=="function"&&c.then(D,X)}catch(m){X(m)}finally{t!==null&&f.types!==null&&(t.types=f.types),d.T=t}},a.unstable_useCacheRefresh=function(){return d.H.useCacheRefresh()},a.use=function(e){return d.H.use(e)},a.useActionState=function(e,t,f){return d.H.useActionState(e,t,f)},a.useCallback=function(e,t){return d.H.useCallback(e,t)},a.useContext=function(e){return d.H.useContext(e)},a.useDebugValue=function(){},a.useDeferredValue=function(e,t){return d.H.useDeferredValue(e,t)},a.useEffect=function(e,t){return d.H.useEffect(e,t)},a.useEffectEvent=function(e){return d.H.useEffectEvent(e)},a.useId=function(){return d.H.useId()},a.useImperativeHandle=function(e,t,f){return d.H.useImperativeHandle(e,t,f)},a.useInsertionEffect=function(e,t){return d.H.useInsertionEffect(e,t)},a.useLayoutEffect=function(e,t){return d.H.useLayoutEffect(e,t)},a.useMemo=function(e,t){return d.H.useMemo(e,t)},a.useOptimistic=function(e,t){return d.H.useOptimistic(e,t)},a.useReducer=function(e,t,f){return d.H.useReducer(e,t,f)},a.useRef=function(e){return d.H.useRef(e)},a.useState=function(e){return d.H.useState(e)},a.useSyncExternalStore=function(e,t,f){return d.H.useSyncExternalStore(e,t,f)},a.useTransition=function(){return d.H.useTransition()},a.version="19.2.0",a}var te;function de(){return te||(te=1,J.exports=fe()),J.exports}var ne=de();const Q=o=>window.growiFacade.react;async function pe(o){let s="";try{const i=await fetch(o);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const l=i.headers.get("Last-Modified");return s=await i.text(),s=s.replace(/,{2,}/g,","),{stats:JSON.parse(s),lastModified:l}}catch(i){throw i instanceof SyntaxError?(console.error("Failed to parse JSON after comma fix:",i),console.error("Fixed response was:",s),new Error(`JSON parse error: ${i.message}`)):i}}const me="/__gpustat__";function xe(){const o=Q(),{useState:s,useCallback:i,useEffect:l}=o,[n,u]=s([]),[h,_]=s(null),[v,j]=s(null),[A,E]=s(null),N=i(async()=>{_(null);try{const{stats:w,lastModified:g}=await pe(me);u(w),E(g),j(new Date)}catch(w){console.error(w),_("Failed to fetch GPU stats.")}},[]);return l(()=>{N();const w=setInterval(N,3e4);return()=>clearInterval(w)},[N]),{stats:n,error:h,lastClientUpdate:v,lastApiUpdate:A,refresh:N}}const oe=ne.createContext(null);function he({children:o}){const s=xe();return r.jsx(oe.Provider,{value:s,children:o})}const re=o=>o!=null;function ye({stats:o}){return r.jsx("div",{className:"overflow-x-auto w-full",children:r.jsxs("table",{className:"w-full bg-white text-3xl",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"サーバ"}),r.jsx("th",{className:"py-4 px-2 border-b-2 border-stone-200",children:"GPU"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"温度"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"計算負荷"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"メモリ (GiB)"}),r.jsx("th",{className:"py-4 px-4 border-b-2 border-stone-200",children:"利用者"})]})}),r.jsx("tbody",{children:o.map(s=>s.gpus.map((i,l)=>{const u=`py-4 px-4 ${l===s.gpus.length-1?"border-b-2 border-stone-200":""}`,h=`${u} text-center`,_=i.name?.replace("Ada Generation","Ada");return r.jsxs("tr",{className:"hover:bg-gray-50",children:[r.jsx("td",{className:u,children:l===0?s.hostname:""}),r.jsx("td",{className:u,children:_}),r.jsxs("td",{className:h,children:[i["temperature.gpu"]," °C"]}),r.jsxs("td",{className:h,children:[i["utilization.gpu"]," %"]}),r.jsx("td",{className:h,children:(()=>{const v=i["memory.used"],j=i["memory.total"],A=re(v)?(v/1024).toFixed(1):"N/A",E=re(j)?(j/1024).toFixed(1):"N/A";return`${A} / ${E}`})()}),r.jsx("td",{className:u,children:i.processes?.map(v=>{const j=v.gpu_memory_usage?(v.gpu_memory_usage/1024).toFixed(1):"N/A";return`${v.username} (${j}GiB)`}).join(", ")})]},`${s.hostname}-${i.uuid}`)}))})]})})}const W=o=>{const s=(1-o/100)*160,[i,l,n]=ve(s,.85,.9);return`hsl(${i}, ${l}%, ${n}%)`},ve=(o,s,i)=>{const l=i*(2-s)/2,n=(i-l)/Math.min(l,1-l);return[o,n*100,l*100]},se=({value:o=75,min:s=0,max:i=100,startAngle:l=-135,endAngle:n=135,size:u=250,strokeWidth:h=20,label:_="Performance",subLabel:v,unit:j="%",showTicks:A=!0,tickCount:E=10,colors:N=W})=>{const w=ne.useId(),g=`gaugeGradient-${w}`,x=`shadow-${w}`,I=Math.max(s,Math.min(i,o)),P=(I-s)/(i-s)*100,H=n-l,b=u/2,O=(u-h)/2,L=H/360*2*Math.PI*O,D=L*(1-P/100),d=(S,C=O)=>{const R=(S-90)*Math.PI/180;return{x:b+C*Math.cos(R),y:b+C*Math.sin(R)}},Y=(S,C,R=O)=>{const M=d(S,R),k=d(C,R),$=C-S<=180?"0":"1";return`M ${M.x} ${M.y} A ${R} ${R} 0 ${$} 1 ${k.x} ${k.y}`},q=()=>{if(!A)return[];const S=[];for(let C=0;C<=E;C++){const R=l+H*C/E,M=d(R,O+5),k=d(R,O+15),$=d(R,O+25),U=s+(i-s)*C/E;S.push(r.jsxs("g",{children:[r.jsx("line",{x1:M.x,y1:M.y,x2:k.x,y2:k.y,stroke:"#94a3b8",strokeWidth:"2"}),r.jsx("text",{x:$.x,y:$.y,textAnchor:"middle",dominantBaseline:"middle",className:"text-xs fill-slate-600",children:Math.round(U)})]},`tick-${C}`))}return S},V=N(P);return r.jsx("div",{className:"flex flex-col items-center py-6 px-8",children:r.jsxs("svg",{width:u,height:u,className:"transform -rotate-0",style:{overflow:"visible"},children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:g,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[r.jsx("stop",{offset:"0%",stopColor:V,stopOpacity:"0.8"}),r.jsx("stop",{offset:"100%",stopColor:V,stopOpacity:"1"})]}),r.jsx("filter",{id:x,children:r.jsx("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodOpacity:"0.2"})})]}),q(),r.jsx("path",{d:Y(l,n),fill:"none",stroke:"#e5e7eb",strokeWidth:h,strokeLinecap:"round"}),r.jsx("path",{d:Y(l,n),fill:"none",stroke:`url(#${g})`,strokeWidth:h,strokeLinecap:"round",filter:`url(#${x})`,strokeDasharray:L,strokeDashoffset:D,style:{transition:"stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}}),r.jsxs("text",{x:b,y:b-(v?20:10),textAnchor:"middle",dominantBaseline:"middle",className:"text-4xl font-bold fill-slate-800",children:[I.toFixed(1),r.jsx("tspan",{className:"text-2xl fill-slate-600",children:j})]}),v&&r.jsx("text",{x:b,y:b+15,textAnchor:"middle",dominantBaseline:"middle",className:"text-xl font-bold fill-slate-500",children:v}),r.jsx("text",{x:b,y:b+(v?40:20),textAnchor:"middle",dominantBaseline:"middle",className:"text-sm fill-slate-500",children:_})]})})},ge=({processes:o})=>{const s=l=>l?(l/1024).toFixed(1):"N/A",i=o?.map(l=>`${l.username||"Unknown"} (${s(l.gpu_memory_usage)}GB)`).join(", ");return r.jsxs("div",{className:"flex flex-col",children:[r.jsx("div",{className:"px-4 py-1 mb-2 text-sm font-semibold text-gray-600 uppercase tracking-wide",children:"Processes"}),r.jsx("div",{className:"px-4 py-2 mb-8 text-xl flex-1 border-l-2 border-gray-300 box-border",children:i})]})},_e="_container_gxmp0_1",je="_header_gxmp0_10",Ee="_gpuName_gxmp0_14",Ne="_gauges_gxmp0_19",B={container:_e,header:je,gpuName:Ee,gauges:Ne},we=({value:o=50,min:s=0,max:i=100,height:l=200,width:n=20,animated:u=!0})=>{const h=Q(),{useState:_,useEffect:v}=h,[j,A]=_(o),E=Math.max(0,Math.min(100,(j-s)/(i-s)*100)),N=g=>{const I=Math.min(100,g/85*100);return W(I)},w=g=>g<=0?N(0):`linear-gradient(to top in oklch, ${Array.from({length:15},(P,H)=>{const b=H/14*g;return N(b)}).join(", ")})`;return v(()=>{A(o)},[o]),r.jsxs("div",{className:"flex flex-col items-center gap-4 p-4",children:[r.jsxs("div",{className:"relative flex items-start gap-4",style:{height:`${l}px`},children:[r.jsxs("div",{className:"relative",style:{width:`${n}px`,height:"100%"},children:[r.jsx("div",{className:"absolute inset-0 bg-gray-200"}),r.jsx("div",{className:`absolute bottom-0 left-0 right-0 ${u?"transition-all duration-500 ease-in-out":""}`,style:{height:`${E}%`,background:w(E)}})]}),r.jsx("div",{className:"relative h-full",children:[0,25,50,75,100].map(g=>r.jsxs("div",{className:"absolute flex items-center gap-1",style:{bottom:`${g}%`,transform:"translateY(50%)",left:"-12px"},children:[r.jsx("div",{className:"w-3 h-0.5 bg-gray-400"}),r.jsx("span",{className:"text-xs text-gray-600 font-medium",children:Math.round(s+(i-s)*g/100)})]},g))})]}),r.jsx("div",{className:"text-center",children:r.jsxs("div",{className:"text-3xl font-bold",style:{color:W(E)},children:[j.toFixed(1),"°C"]})})]})};function be({gpu:o}){const s=o["utilization.gpu"]??0,i=o["memory.used"]??0,l=o["memory.total"]??0,n=o["temperature.gpu"]??0,u=o["power.draw"]??0;return console.log(o.name,o.index),r.jsxs("div",{className:B.container,children:[r.jsx("div",{className:B.header,children:r.jsxs("h3",{className:B.gpuName,children:["GPU ",o.index,": ",o.name]})}),r.jsxs("div",{className:B.gauges,children:[r.jsx("div",{}),r.jsx(we,{value:n,max:100,height:200}),r.jsx("div",{}),r.jsx(se,{value:s,subLabel:`${u}W`,label:"GPU Utilization",unit:"%"}),r.jsx("div",{}),r.jsx(se,{value:i/1024,max:l/1024,label:"Memory",unit:"GiB"}),r.jsx("div",{}),r.jsx(ge,{processes:o.processes}),r.jsx("div",{})]})]})}function Re({stat:o}){return r.jsx("div",{children:o.gpus.map(s=>r.jsx(be,{gpu:s},s.index))})}const Te=()=>{const o=Q(),{useState:s,useContext:i}=o,l=i(oe),[n,u]=s("all");if(!l)throw new Error("GpuStatusDisplay must be used within a GpuStatsProvider");const{stats:h,error:_,lastApiUpdate:v,refresh:j}=l,A=["all",...new Set(h.map(x=>x.hostname).filter(x=>x))],E=x=>x?x.toLocaleString():"N/A",N=x=>x?E(new Date(x)):"N/A",w=x=>`px-4 py-2 text-2xl font-semibold border-b-2${n===x?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,g=n==="all"?null:h.find(x=>x.hostname===n);return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center mb-2",children:[r.jsx("button",{onClick:j,className:"p-2 rounded-full hover:bg-gray-200 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-gray-400",children:r.jsx("img",{src:"/refresh.svg",alt:"Refresh",className:"w-6 h-6"})}),r.jsx("div",{className:"ml-1 text-lg text-gray-600",children:r.jsxs("p",{className:"m-0",children:["Last Updated: ",N(v)]})})]}),_&&r.jsx("p",{className:"text-red-500",children:_}),r.jsx("div",{className:"border-b-2 border-stone-200",children:r.jsx("nav",{className:"-mb-px flex","aria-label":"Tabs",children:A.map(x=>r.jsx("button",{onClick:()=>u(x),className:w(x),children:x==="all"?"All":x},x))})}),r.jsx("div",{className:"mt-4",children:n==="all"?r.jsx(ye,{stats:h}):g?r.jsx(Re,{stat:g}):r.jsx("p",{children:"Host not found."})})]})},Ce=()=>r.jsx(he,{children:r.jsx(Te,{})}),Ae=()=>{if(growiFacade==null||growiFacade.markdownRenderer==null)return;const{optionsGenerators:o}=growiFacade.markdownRenderer,s=o.customGenerateViewOptions;o.customGenerateViewOptions=(...i)=>{const l=s?s(...i):o.generateViewOptions(...i),n=l.components.table;return l.components.table=u=>u.className?.includes("gpu-stat")?r.jsx(Ce,{...u}):r.jsx(n,{...u}),l}},Se=()=>{};window.pluginActivators==null&&(window.pluginActivators={});window.pluginActivators["growi-plugin-gpu-stat"]={activate:Ae,deactivate:Se};
